<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –∏–≥—Ä - Steam Clone</title>
    <link rel="shortcut icon" href="/ico.ico" type="image/x-icon">
    <link rel="icon" href="/ico.ico" type="image/x-icon">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            background: #1b2838;
            color: #c6d4df;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: #171a21;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }
        
        h1 {
            color: #66c0f4;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: #8f98a0;
            font-size: 14px;
        }
        
        input[type="text"],
        textarea,
        input[type="file"] {
            width: 100%;
            padding: 10px;
            background: #1b2838;
            border: 1px solid #3d4450;
            border-radius: 4px;
            color: #c6d4df;
            font-size: 14px;
        }
        
        textarea {
            min-height: 120px;
            resize: vertical;
        }
        
        input[type="file"] {
            padding: 8px;
            cursor: pointer;
        }
        
        .image-preview {
            margin-top: 10px;
            max-width: 100%;
            max-height: 300px;
            border-radius: 4px;
            display: none;
        }
        
        .image-preview.show {
            display: block;
        }
        
        .btn {
            background: #1a9fff;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            width: 100%;
            margin-top: 20px;
        }
        
        .btn:hover {
            background: #00bbff;
        }
        
        .result {
            margin-top: 30px;
            padding: 20px;
            background: #1b2838;
            border-radius: 4px;
            display: none;
        }
        
        .result.show {
            display: block;
        }
        
        .result-link {
            color: #66c0f4;
            word-break: break-all;
            margin-top: 10px;
            display: block;
        }
        
        .result-link:hover {
            color: #1a9fff;
        }
        
        .info {
            background: #2a475e;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
            font-size: 13px;
            line-height: 1.6;
        }
        
        .example-link {
            margin-top: 20px;
            padding: 15px;
            background: #2a475e;
            border-radius: 4px;
            text-align: center;
        }
        
        .example-link a {
            color: #66c0f4;
            text-decoration: none;
            font-size: 14px;
        }
        
        .example-link a:hover {
            color: #1a9fff;
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéÆ –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –∏–≥—Ä</h1>
        
        <div class="info">
            <strong>–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:</strong><br>
            –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É –Ω–∏–∂–µ, –∑–∞–≥—Ä—É–∑–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, –∏ –ø–æ–ª—É—á–∏—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤–∞—à–µ–π –∏–≥—Ä—ã –≤ —Å—Ç–∏–ª–µ Steam.
            –°—Å—ã–ª–∫–∞ –±—É–¥–µ—Ç –∏–º–µ—Ç—å —Ñ–æ—Ä–º–∞—Ç: <code>https://store-steampowereed.ru/app/{ID}/{NAME}/</code>
        </div>
        
        <form id="gameForm">
            <div class="form-group">
                <label for="gameName">–ù–∞–∑–≤–∞–Ω–∏–µ –∏–≥—Ä—ã *</label>
                <input type="text" id="gameName" name="gameName" required placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: My Awesome Game">
            </div>
            
            <div class="form-group">
                <label for="gameDescription">–û–ø–∏—Å–∞–Ω–∏–µ –∏–≥—Ä—ã *</label>
                <textarea id="gameDescription" name="gameDescription" required placeholder="–û–ø–∏—à–∏—Ç–µ –≤–∞—à—É –∏–≥—Ä—É..."></textarea>
            </div>
            
            <div class="form-group">
                <label for="developer">–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫</label>
                <input type="text" id="developer" name="developer" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Å—Ç—É–¥–∏–∏">
            </div>
            
            <div class="form-group">
                <label for="publisher">–ò–∑–¥–∞—Ç–µ–ª—å</label>
                <input type="text" id="publisher" name="publisher" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∏–∑–¥–∞—Ç–µ–ª—è">
            </div>
            
            <div class="form-group">
                <label for="releaseDate">–î–∞—Ç–∞ –≤—ã—Ö–æ–¥–∞</label>
                <input type="text" id="releaseDate" name="releaseDate" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: Oct 31, 2025">
            </div>
            
            <div class="form-group">
                <label for="mainImage">–ì–ª–∞–≤–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (–æ–±–ª–æ–∂–∫–∞) *</label>
                <input type="file" id="mainImage" name="mainImage" accept="image/*" required>
                <img id="mainImagePreview" class="image-preview" alt="Preview">
            </div>
            
            <div class="form-group">
                <label for="screenshots">–°–∫—Ä–∏–Ω—à–æ—Ç—ã (–º–æ–∂–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ)</label>
                <input type="file" id="screenshots" name="screenshots" accept="image/*" multiple>
                <div id="screenshotsPreview" style="margin-top: 10px; display: flex; flex-wrap: wrap; gap: 10px;"></div>
            </div>
            
            <button type="submit" class="btn">–°–æ–∑–¥–∞—Ç—å –∏–≥—Ä—É</button>
        </form>
        
        <div id="result" class="result">
            <h3 style="color: #66c0f4; margin-bottom: 10px;">‚úÖ –ò–≥—Ä–∞ —Å–æ–∑–¥–∞–Ω–∞!</h3>
            <p>–í–∞—à–∞ —Å—Å—ã–ª–∫–∞:</p>
            <a id="resultLink" class="result-link" href="#" target="_blank"></a>
            <p style="margin-top: 15px; font-size: 13px; color: #8f98a0;">
                –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å—Å—ã–ª–∫—É –∏ –ø–æ–¥–µ–ª–∏—Ç–µ—Å—å –µ—é —Å –¥—Ä—É–∑—å—è–º–∏!
            </p>
        </div>
        
        <div class="example-link">
            <p style="color: #8f98a0; margin-bottom: 10px; font-size: 13px;">–ü—Ä–∏–º–µ—Ä —Å–æ–∑–¥–∞–Ω–Ω–æ–π –∏–≥—Ä—ã:</p>
            <a href="/app/1757350/TWITCH-PHOBIA/" target="_blank">TWITCH-PHOBIA</a>
        </div>
    </div>
    
    <script>
        // Preview –¥–ª—è –≥–ª–∞–≤–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        document.getElementById('mainImage').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const preview = document.getElementById('mainImagePreview');
                    preview.src = e.target.result;
                    preview.classList.add('show');
                };
                reader.readAsDataURL(file);
            }
        });
        
        // Preview –¥–ª—è —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤
        document.getElementById('screenshots').addEventListener('change', function(e) {
            const files = Array.from(e.target.files);
            const previewContainer = document.getElementById('screenshotsPreview');
            previewContainer.innerHTML = '';
            
            files.forEach(file => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = document.createElement('img');
                    img.src = e.target.result;
                    img.style.maxWidth = '150px';
                    img.style.maxHeight = '100px';
                    img.style.objectFit = 'cover';
                    img.style.borderRadius = '4px';
                    previewContainer.appendChild(img);
                };
                reader.readAsDataURL(file);
            });
        });
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã
        document.getElementById('gameForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const gameData = {
                name: formData.get('gameName'),
                description: formData.get('gameDescription'),
                developer: formData.get('developer') || 'Unknown Developer',
                publisher: formData.get('publisher') || 'Unknown Publisher',
                releaseDate: formData.get('releaseDate') || 'To be announced',
                mainImage: null,
                screenshots: []
            };
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª—É—á–∞–π–Ω—ã–π ID
            const gameId = Math.floor(1000000 + Math.random() * 9000000);
            const gameSlug = gameData.name.toLowerCase()
                .replace(/[^a-z0-9]+/g, '-')
                .replace(/^-+|-+$/g, '');
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ base64
            const mainImageFile = formData.get('mainImage');
            if (mainImageFile) {
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–∞–∫ base64 –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã (–≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –ª—É—á—à–µ –∑–∞–≥—Ä—É–∂–∞—Ç—å –≤ R2)
                gameData.mainImageBase64 = await fileToBase64(mainImageFile);
                gameData.mainImage = null; // –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø—É—Ç—å, —Ç–æ–ª—å–∫–æ base64
            }
            
            const screenshots = formData.getAll('screenshots');
            gameData.screenshotsBase64 = [];
            for (const screenshot of screenshots) {
                if (screenshot.size > 0) {
                    gameData.screenshotsBase64.push(await fileToBase64(screenshot));
                }
            }
            gameData.screenshots = []; // –û—á–∏—â–∞–µ–º —Å—Ç–∞—Ä—ã–µ –ø—É—Ç–∏
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –∏–≥—Ä—ã
            gameData.id = gameId;
            gameData.slug = gameSlug;
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä
            try {
                const response = await fetch('/api/save-game', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(gameData)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                    const resultDiv = document.getElementById('result');
                    const resultLink = document.getElementById('resultLink');
                    const url = `${window.location.origin}${result.game.url}`;
                    resultLink.href = url;
                    resultLink.textContent = url;
                    resultDiv.classList.add('show');
                    
                    // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É
                    resultDiv.scrollIntoView({ behavior: 'smooth' });
                    
                    // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
                    e.target.reset();
                    document.getElementById('mainImagePreview').classList.remove('show');
                    document.getElementById('screenshotsPreview').innerHTML = '';
                } else {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏: ' + (result.error || 'Unknown error'));
                }
            } catch (error) {
                console.error('Error saving game:', error);
                // Fallback: —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
                const games = JSON.parse(localStorage.getItem('games') || '[]');
                games.push(gameData);
                localStorage.setItem('games', JSON.stringify(games));
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                const resultDiv = document.getElementById('result');
                const resultLink = document.getElementById('resultLink');
                const url = `${window.location.origin}/app/${gameId}/${gameSlug}/`;
                resultLink.href = url;
                resultLink.textContent = url;
                resultDiv.classList.add('show');
                resultDiv.scrollIntoView({ behavior: 'smooth' });
                
                alert('–ò–≥—Ä–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ. –î–ª—è —Ä–∞–±–æ—Ç—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –Ω—É–∂–µ–Ω Cloudflare KV.');
            }
        });
        
        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }
    </script>
</body>
</html>